<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V3 - THE LOFT HUB</title>
<style>
  /* IF YOU SEE RED, THE NEW VERSION IS LOADED */
  .version-check { background: red; color: white; text-align: center; padding: 5px; font-weight: bold; }
  
  body { font-family: 'Montserrat', sans-serif; background: #0f0c29; color: white; margin: 0; }
  #loginOverlay { position: fixed; inset: 0; background: #0f0c29; display: flex; align-items: center; justify-content: center; z-index: 100; }
  .login-card { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; border: 2px solid #00d4ff; text-align: center; }
  input { display: block; width: 100%; margin: 10px 0; padding: 10px; border-radius: 5px; border: none; }
  button { width: 100%; padding: 10px; background: #00d4ff; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
  
  #staffContent { display: none; padding: 20px; }
  .workflow { display: flex; gap: 20px; }
  .col { flex: 1; background: rgba(255,255,255,0.05); border-radius: 15px; padding: 15px; min-height: 500px; }
  .card { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid #00d4ff; }
  .btn-box { display: flex; gap: 5px; margin-top: 10px; }
  .b { flex: 1; border: none; padding: 5px; border-radius: 5px; cursor: pointer; font-size: 10px; font-weight: bold; }
</style>
</head>
<body>

<div class="version-check">VERSION 3.0 LOADED (IF YOU SEE THIS, IT UPDATED)</div>

<div id="loginOverlay">
  <div class="login-card">
    <h2>STAFF LOGIN</h2>
    <input type="text" id="adminID" placeholder="Email">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="handleLogin()">LOGIN</button>
  </div>
</div>

<div id="staffContent">
  <div class="workflow">
    <div class="col"><h3>PENDING</h3><div id="p-list"></div></div>
    <div class="col"><h3>APPROVED</h3><div id="a-list"></div></div>
    <div class="col"><h3>REJECTED</h3><div id="r-list"></div></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCHzOsZpSWN7fwEXALbPzPsknjROPp5Bf4",
  authDomain: "the-loft-hub.firebaseapp.com",
  projectId: "the-loft-hub",
  storageBucket: "the-loft-hub.firebasestorage.app",
  messagingSenderId: "720306031954",
  appId: "1:720306031954:web:1f242a6e1531fe58587e8b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.handleLogin = function() {
  if(document.getElementById('adminID').value === "lofthub@login.info" && document.getElementById('adminPass').value === "Bookingspace") {
    document.getElementById('loginOverlay').style.display = 'none';
    document.getElementById('staffContent').style.display = 'block';
    start();
  }
}

function start() {
  onSnapshot(collection(db, "bookings"), snap => {
    const p=document.getElementById("p-list"), a=document.getElementById("a-list"), r=document.getElementById("r-list");
    p.innerHTML=a.innerHTML=r.innerHTML="";
    snap.forEach(s => {
      const b=s.data(); const id=s.id;
      const h = `<div class="card">
        <b>${b.name}</b><br><small>${b.date}</small>
        <div class="btn-box">
          <button class="b" style="background:#00ffcc" onclick="up('${id}','Approved')">Approve</button>
          <button class="b" style="background:#ff4d4d;color:white" onclick="up('${id}','Rejected')">Reject</button>
        </div>
      </div>`;
      if(b.status === "Approved") a.innerHTML+=h;
      else if(b.status === "Rejected") r.innerHTML+=h;
      else p.innerHTML+=h;
    });
  });
}

window.up = async (id, s) => { await updateDoc(doc(db, "bookings", id), {status: s}); };
</script>
</body>
</html>
