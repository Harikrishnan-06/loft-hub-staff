<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE LOFT HUB | Staff Dashboard</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap');

body {
  font-family: 'Montserrat', sans-serif;
  /* Matching the fancy animated background from the main page */
  background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #4a1942);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  min-height: 100vh;
  color: white;
  margin: 0;
  padding: 20px;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

header {
  text-align: center;
  margin-bottom: 40px;
}

header h2 {
  letter-spacing: 4px;
  font-weight: 700;
  text-transform: uppercase;
  margin-bottom: 10px;
}

.stats-bar {
  font-size: 14px;
  opacity: 0.8;
  margin-bottom: 20px;
}

.container {
  max-width: 900px;
  margin: 0 auto;
}

/* Glassmorphism Booking Card */
.card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 25px;
  margin-bottom: 20px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  transition: transform 0.3s ease;
}

.card:hover {
  transform: scale(1.01);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding-bottom: 15px;
  margin-bottom: 15px;
}

.client-name {
  font-size: 20px;
  font-weight: 700;
  color: #fff;
}

.event-type {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.details {
  font-size: 15px;
  line-height: 1.6;
  margin-bottom: 15px;
}

.status-badge {
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 4px;
}

.status-Pending { color: #ffcc00; }
.status-Approved { color: #00ffcc; }
.status-Rejected { color: #ff4d4d; }

textarea {
  width: 100%;
  background: rgba(0, 0, 0, 0.3);
  color: white;
  margin-top: 15px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
  font-family: inherit;
  resize: vertical;
}

.actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 30px;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.approve { background: #22c55e; color: #052e16; }
.approve:hover { background: #4ade80; box-shadow: 0 0 15px rgba(34, 197, 94, 0.4); }

.reject { background: #ef4444; color: white; }
.reject:hover { background: #f87171; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }

.timestamp {
  margin-top: 15px;
  font-size: 11px;
  opacity: 0.5;
  text-align: right;
}
</style>
</head>

<body>

<header>
  <h2>THE LOFT HUB</h2>
  <div class="stats-bar">Staff Booking Management System</div>
</header>

<div class="container" id="list">
    <div style="text-align:center; opacity:0.5;">Connecting to Secure Vault...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCHzOsZpSWN7fwEXALbPzPsknjROPp5Bf4",
  authDomain: "the-loft-hub.firebaseapp.com",
  projectId: "the-loft-hub",
  storageBucket: "the-loft-hub.firebasestorage.app",
  messagingSenderId: "720306031954",
  appId: "1:720306031954:web:1f242a6e1531fe58587e8b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const list = document.getElementById("list");

// Real-time listener ordered by newest first
const q = query(collection(db, "bookings"), orderBy("createdAt", "desc"));

onSnapshot(q, snap => {
  if (snap.empty) {
    list.innerHTML = "<div style='text-align:center;'>No booking requests found.</div>";
    return;
  }

  list.innerHTML = "";

  snap.forEach(docSnap => {
    const b = docSnap.data();
    const id = docSnap.id;

    const requestedTime = b.createdAt
      ? b.createdAt.toDate().toLocaleString()
      : "Just now";

    list.innerHTML += `
      <div class="card">
        <div class="card-header">
            <span class="client-name">${b.name || 'Anonymous'}</span>
            <span class="event-type">${b.eventType || 'Event'}</span>
        </div>
        
        <div class="details">
            üìß <b>Email:</b> ${b.email}<br>
            üìû <b>Phone:</b> ${b.phone}<br>
            üìÖ <b>Date:</b> ${b.date} | üë• <b>Guests:</b> ${b.guests}<br>
            üìù <b>Notes:</b> ${b.notes || 'None'}<br>
            üìå <b>Status:</b> <span class="status-badge status-${b.status}">${b.status}</span>
        </div>

        <textarea id="note-${id}" placeholder="Internal Staff Notes (e.g. Deposit paid, catering confirmed)">${b.staffNotes || ""}</textarea>

        <div class="actions">
            <button class="approve" onclick="updateStatus('${id}','Approved')">Approve</button>
            <button class="reject" onclick="updateStatus('${id}','Rejected')">Reject</button>
        </div>

        <div class="timestamp">
          Requested On: ${requestedTime}
        </div>
      </div>
    `;
  });
});

/* üîπ Update function exposed to window for HTML onclick access */
window.updateStatus = async (id, newStatus) => {
  const noteContent = document.getElementById(`note-${id}`).value;
  try {
    const docRef = doc(db, "bookings", id);
    await updateDoc(docRef, {
      status: newStatus,
      staffNotes: noteContent
    });
  } catch (error) {
    console.error("Error updating document: ", error);
    alert("Update failed. Check console.");
  }
};
</script>

</body>
</html>
